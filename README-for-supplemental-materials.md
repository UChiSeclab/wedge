# WEDGE: An Efficient Framework for Performance-Stressing Test Generation

WEDGE is a framework for generating performance-stressing inputs given a program-under-test. WEDGE synthesizes explicit performance-characterizing constraints in the form of branch conditions to partition the programs’ execution space into9
performance-specific regions with the help of language models. WEDGE is integareted with a coverage-guided fuzzer based on AFL++ to generate tests regions introduces explicit rewards for test generation to explore inefficient implementations. 

This repository contains the tests generated by WEDGE collected into a new benchmark called PerfForge. We hope PerfForge can serve evaluate future (AI-driven) approaches for efficient code-generation.

## 1. Getting Started

The repository has the following directory structure. Users are recommended not to alter this structure unless they also modify the tooling in `./code`.

```
wedge
├── problems
|   ├── problemA
|   |   ├── metadata
|   |   |   ├── problem_statement.txt
|   |   |   ├── llm_prompt_constraints.txt
|   |   |   └── llm_response_constraints.txt
|   |   ├── solutions
|   |   |   ├── sol1.cpp
|   |   |   ├── sol2.cpp
|   |   |    ...
|   |   └── tests
|   |       ├── codecontests
|   |       ├── wedge
|   |       ├── evalperf_random
|   |       ├── evalperf_slowom
|   |       └── test_gen_prompt
|   ├── problemB
|   |   ├── ...  
 ...
├── data
|   ├── codecontests
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   ├── wedge
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   ├── wedge_yesInstr_defaultMut
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   ├── wedge_noInstr_constrntMut
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   ├── wedge_noInstr_defaultMut
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ... 
|   ├── evalperf_random
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   ├── evalperf_slow
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
|   └── test_gen_prompt
|   |   ├── problemA.json
|   |   ├── problemB.json
|   |   ...
├── code
|  ├── stats/
|  ├── run_tests/
|  └── prompting/
├── README
└── LICENSE
```

### 1.1. Cloning the repository

**Step #1**: To download the repository locally, users can run the following command:
```
git clone https://github.com/elmerjfudd/wedge
```
We encourate users to check that the downloaded copy has the same directory structure as above.

### 1.2. Environment Setup

WEDGE relies on a few dependencies:
- Ubuntu 20.04 or later
- Python 3.10 or later, along with several relevant packages
- `perf` 5.15 or later
- `gcov` 11.4 or later

**Step #2**: To install these dependencies, users can run the following command:
```
cd  /path/to/wedge/repo
sudo ./setup_env.sh
```
> [!NOTE]
> Some of the dependencies (e.g. `perf`) require root user privileges to install and configure.

**Step #3**: Finally, users need to update their `PYTHONPATH` environment varialbe:
```
cd /path/to/wedge/repo
export PYTHONPATH=$PYTHONPATH:$(pwd)/code
```

## 2. Collecting statistics over our raw data

We provide users with the raw measurements collected by WEDGE. This way, users can collect statistics and recreate the tables and figures for our main experiements: WEDGE vs. baslines; and WEDGE vs. its ablated versions.

To generate statistics, users should use the `./code/stats` utility:
```
python3 ./code/stats/main.py 
                 --data-path DATA_DIR
                 --summaries-out-path STATS_DIR 
                 [--language LANGUAGE]
```
where
- `--data-path` is the path to the JSON files containing the raw measurements
- `--summaries-out-path` is the path where the tool should save the statistics (CSV files, plain-text and LaTeX summary tables, plots)
- `--language` is on optional parameter limiting the tool to operate only on a specific programming language (`cpp`, `java`, or `python`); if no luanguage is selected the default is `cpp`

Here is an usage example, assuming the directory structure above:
```
cd /path/to/wedge/repo
python3 ./code/stats/main.py --data-path $(pwd)/data/ --summaries-out-path $(pwd)/summaries --language cpp
```
This command will populate the `summaries/tables`, `summaires/plots` and `summaries/csv` directories with the tables, plots and aggregated measurements in CSV format that comprise the key results of our original main experiments.  

## 3. Re-run our main experiments

